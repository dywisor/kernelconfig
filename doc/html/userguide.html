<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.12: http://docutils.sourceforge.net/" />
<title>kernelconfig - Generate Linux kernel configuration files</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7614 2013-02-21 15:55:51Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="auto-toc simple">
<li><a class="reference internal" href="#id1" id="id4">1&nbsp;&nbsp;&nbsp;kernelconfig</a><ul class="auto-toc">
<li><a class="reference internal" href="#introduction" id="id5">1.1&nbsp;&nbsp;&nbsp;Introduction</a></li>
<li><a class="reference internal" href="#installing-kernelconfig" id="id6">1.2&nbsp;&nbsp;&nbsp;Installing kernelconfig</a><ul class="auto-toc">
<li><a class="reference internal" href="#dependencies" id="id7">1.2.1&nbsp;&nbsp;&nbsp;Dependencies</a></li>
<li><a class="reference internal" href="#via-emerge-gentoo" id="id8">1.2.2&nbsp;&nbsp;&nbsp;via emerge (Gentoo)</a></li>
<li><a class="reference internal" href="#manual-installation" id="id9">1.2.3&nbsp;&nbsp;&nbsp;Manual Installation</a></li>
<li><a class="reference internal" href="#running-kernelconfig-without-installing-it" id="id10">1.2.4&nbsp;&nbsp;&nbsp;Running kernelconfig without installing it</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-kernelconfig" id="id11">1.3&nbsp;&nbsp;&nbsp;Running kernelconfig</a></li>
<li><a class="reference internal" href="#settings-file" id="id12">1.4&nbsp;&nbsp;&nbsp;Settings File</a><ul class="auto-toc">
<li><a class="reference internal" href="#settings-directories" id="id13">1.4.1&nbsp;&nbsp;&nbsp;Settings Directories</a></li>
<li><a class="reference internal" href="#source" id="id14">1.4.2&nbsp;&nbsp;&nbsp;[source]</a><ul class="auto-toc">
<li><a class="reference internal" href="#using-a-curated-source" id="id15">1.4.2.1&nbsp;&nbsp;&nbsp;Using a curated source</a></li>
<li><a class="reference internal" href="#using-defconfig-as-configuration-source" id="id16">1.4.2.2&nbsp;&nbsp;&nbsp;Using defconfig as configuration source</a></li>
<li><a class="reference internal" href="#using-a-file-as-configuration-source" id="id17">1.4.2.3&nbsp;&nbsp;&nbsp;Using a file as configuration source</a></li>
<li><a class="reference internal" href="#using-a-command-as-configuration-source" id="id18">1.4.2.4&nbsp;&nbsp;&nbsp;Using a command as configuration source</a></li>
<li><a class="reference internal" href="#using-a-script-as-configuration-source" id="id19">1.4.2.5&nbsp;&nbsp;&nbsp;Using a script as configuration source</a></li>
<li><a class="reference internal" href="#configuration-source-environment-variables" id="id20">1.4.2.6&nbsp;&nbsp;&nbsp;Configuration Source Environment Variables</a></li>
<li><a class="reference internal" href="#configuration-source-format-variables" id="id21">1.4.2.7&nbsp;&nbsp;&nbsp;Configuration Source Format Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#options" id="id22">1.4.3&nbsp;&nbsp;&nbsp;[options]</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hardware-detection" id="id23">1.5&nbsp;&nbsp;&nbsp;Hardware Detection</a><ul class="auto-toc">
<li><a class="reference internal" href="#modalias-information-source" id="id24">1.5.1&nbsp;&nbsp;&nbsp;Modalias Information Source</a></li>
<li><a class="reference internal" href="#collecting-hardware-information-on-a-different-machine" id="id25">1.5.2&nbsp;&nbsp;&nbsp;Collecting Hardware Information on a Different Machine</a><ul class="auto-toc">
<li><a class="reference internal" href="#hwinfo-file" id="id26">1.5.2.1&nbsp;&nbsp;&nbsp;hwinfo file</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#package-management-integration" id="id27">1.6&nbsp;&nbsp;&nbsp;Package Management Integration</a></li>
<li><a class="reference internal" href="#curated-sources" id="id28">1.7&nbsp;&nbsp;&nbsp;Curated Sources</a><ul class="auto-toc">
<li><a class="reference internal" href="#script-only-curated-sources" id="id29">1.7.1&nbsp;&nbsp;&nbsp;Script-Only Curated Sources</a></li>
<li><a class="reference internal" href="#source-definition-file" id="id30">1.7.2&nbsp;&nbsp;&nbsp;Source Definition File</a></li>
<li><a class="reference internal" href="#python-module-configuration-sources" id="id31">1.7.3&nbsp;&nbsp;&nbsp;Python-Module Configuration Sources</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id1">
<h1><a class="toc-backref" href="#contents">1&nbsp;&nbsp;&nbsp;kernelconfig</a></h1>
<p>Generate Linux kernel configuration files from curated sources,
detected hardware, installed packages and user input.</p>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#contents">1.1&nbsp;&nbsp;&nbsp;Introduction</a></h2>
</div>
<div class="section" id="installing-kernelconfig">
<h2><a class="toc-backref" href="#contents">1.2&nbsp;&nbsp;&nbsp;Installing kernelconfig</a></h2>
<div class="section" id="dependencies">
<h3><a class="toc-backref" href="#contents">1.2.1&nbsp;&nbsp;&nbsp;Dependencies</a></h3>
<p>Required:</p>
<ul class="simple">
<li>Python &gt;= 3.4, or Python 3.3 with backports: enum</li>
<li><a class="reference external" href="https://pypi.python.org/pypi/toposort/">toposort</a></li>
<li>Python Lex-Yacc (<a class="reference external" href="https://pypi.python.org/pypi/ply/">PLY</a>)</li>
<li>GNU make</li>
<li>git for various configuration sources</li>
<li>C compiler, ...</li>
</ul>
<p>Optional, but recommended:</p>
<ul class="simple">
<li>portage for <em>package management integration</em></li>
<li>kmod with Python bindings
for hardware detection based on module aliases</li>
<li>Python modules: lxml and beautifulsoup (&gt;= 4),
for the Ubuntu configuration source</li>
<li>perl,
for the Fedora configuration source</li>
</ul>
<p>Optional:</p>
<ul class="simple">
<li>Linux kernel sources for copying certain files from <tt class="docutils literal">scripts/kconfig</tt>,
a bundled copy is used otherwise</li>
</ul>
</div>
<div class="section" id="via-emerge-gentoo">
<h3><a class="toc-backref" href="#contents">1.2.2&nbsp;&nbsp;&nbsp;via emerge (Gentoo)</a></h3>
<p>A live ebuild for <tt class="docutils literal"><span class="pre">sys-kernel/kernelconfig</span></tt>
is available in the <a class="reference external" href="https://github.com/dywisor/tlp-portage">kernelconfig-portage</a> overlay.</p>
<p>To add it with <a class="reference external" href="https://wiki.gentoo.org/wiki/Layman">layman</a>, run:</p>
<pre class="literal-block">
$ layman -o &quot;https://raw.githubusercontent.com/dywisor/kernelconfig-portage/master/layman.xml&quot; -f -a kernelconfig
</pre>
<p>The live ebuild needs to be <tt class="docutils literal">KEYWORDS</tt>-unmasked:</p>
<pre class="literal-block">
$ mkdir -p /etc/portage/package.accept_keywords
$ echo &quot;~sys-kernel/kernelconfig-9999 **&quot; &gt;&gt; /etc/portage/package.accept_keywords/kernelconfig
</pre>
<p>It can then be installed with:</p>
<pre class="literal-block">
$ emerge -a sys-kernel/kernelconfig
</pre>
</div>
<div class="section" id="manual-installation">
<h3><a class="toc-backref" href="#contents">1.2.3&nbsp;&nbsp;&nbsp;Manual Installation</a></h3>
<p>First, make sure to install the <a class="reference internal" href="#dependencies">dependencies</a>.</p>
<p>After that, clone the <a class="reference external" href="https://github.com/dywisor/kernelconfig">git repo</a> and
change to working directory to kernelconfig's sources:</p>
<pre class="literal-block">
git clone git://github.com/dywisor/kernelconfig.git

cd kernelconfig
</pre>
<p>Then, prepare the build by creating an <em>installinfo</em> file,
which tells kernelconfig where to find its config and data files, once installed.
This can be done with <tt class="docutils literal">make <span class="pre">prepare-installinfo</span></tt>,
it should receive the same variables as <tt class="docutils literal">setup.py install</tt>
and <tt class="docutils literal">make install</tt> later on (except for <tt class="docutils literal">DESTDIR</tt>):</p>
<pre class="literal-block">
PREFIX=/usr/local   # default: /usr/local
SYSCONFDIR=/etc     # default: /usr/local/etc

make prepare-installinfo PREFIX=&quot;${PREFIX}&quot; SYSCONFDIR=&quot;${SYSCONFDIR}&quot;
</pre>
<p>Building requires a copy of some files from the Linux kernel sources.
At this point, it is necessary to decide whether to use the bundled copy
distributed with kernelconfig, which is recommended,
or to import the files from a kernel source tree.</p>
<p>To use the bundled lkc files, export <tt class="docutils literal">LKCONFIG_LKC</tt>:</p>
<pre class="literal-block">
export LKCONFIG_LKC=&quot;src/lkc-bundled&quot;
</pre>
<p>Alternatively, to import the lkc files from a kernel source tree, run:</p>
<pre class="literal-block">
make import-lkc LK_SRC=/usr/src/linux
#export LKCONFIG_LKC=&quot;src/lkc&quot;  # not necessary
</pre>
<p>After preparing <em>installinfo</em> and the lkc files,
build kernelconfig with <tt class="docutils literal">setup.py</tt>:</p>
<pre class="literal-block">
python ./setup.py build
</pre>
<p>This step can be repeated in case of multiple Python versions.</p>
<p>Finally, kernelconfig can be installed.
The python files are installed with <tt class="docutils literal">setup.py</tt>,
and the data and config files with <tt class="docutils literal">make</tt>:</p>
<pre class="literal-block">
# install
DESTDIR=/
python ./setup.py install --root &quot;${DESTDIR}&quot; --prefix &quot;${PREFIX}&quot;
make install-data install-config DESTDIR=&quot;${DESTDIR}&quot; PREFIX=&quot;${PREFIX}&quot; SYSCONFDIR=&quot;${SYSCONFDIR}&quot;
</pre>
<p>The install-related <tt class="docutils literal">make</tt> variables
follow the <a class="reference external" href="https://www.gnu.org/prep/standards/html_node/Directory-Variables.html">GNU Coding Standards: Directory Variables</a>,
except that the names are in uppercase.
See <tt class="docutils literal">mk/install.mk</tt> for a list of variables.</p>
</div>
<div class="section" id="running-kernelconfig-without-installing-it">
<span id="standalone-mode"></span><h3><a class="toc-backref" href="#contents">1.2.4&nbsp;&nbsp;&nbsp;Running kernelconfig without installing it</a></h3>
<p>kernelconfig can be run in <em>standalone</em> mode from the project's sources.
For this purpose, it offers a wrapper script named <tt class="docutils literal">kernelconfig.py</tt>
that takes care of running <tt class="docutils literal">setup.py</tt> and invoking the main script.</p>
<p>First, get the sources by cloning the <a class="reference external" href="https://github.com/dywisor/kernelconfig">git repo</a>:</p>
<pre class="literal-block">
$ mkdir -p ~/git
$ git clone git://github.com/dywisor/kernelconfig.git ~/git/kernelconfig
</pre>
<p>The wrapper can be run directly:</p>
<pre class="literal-block">
$ ~/git/kernelconfig/kernelconfig.py
</pre>
<p>It can also be <em>installed</em> by creating a symlink to it in one of the
<tt class="docutils literal">PATH</tt> directories.</p>
<p>For example, if <tt class="docutils literal">~/bin</tt> is in your <tt class="docutils literal">PATH</tt>:</p>
<pre class="literal-block">
$ ln -s ~/git/kernelconfig/kernelconfig.py ~/bin/kernelconfig
$ kernelconfig
</pre>
<p>Throughout the following sections,
<tt class="docutils literal">&lt;prjroot&gt;</tt> will be used to refer to the project's source directory.</p>
<p>It accepts all of the <a class="reference internal" href="#usual-options">usual options</a>, and additionally:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--wrapper-help</span></kbd></td>
<td>Prints a help message describing the wrapper's options.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--wrapper-prjroot <var>&lt;PRJROOT&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Path to the project's sources.</p>
<p class="last">If not specified, defaults to the directory containing the wrapper script.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--wrapper-build-base <var>&lt;BUILD_BASE&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Root directory for build files, can also be specified via the
<tt class="docutils literal">PY_BUILDDIR</tt> environment variable.</p>
<p>Defaults to <tt class="docutils literal"><span class="pre">&lt;PRJROOT&gt;/build</span></tt>.</p>
<p class="last">The wrapper creates per-Python version subdirectories in
<tt class="docutils literal"><span class="pre">&lt;BUILD_BASE&gt;/kernelconfig-standalone</span></tt>.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--wrapper-lkc <var>&lt;LKC_SRC&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Alternate path to lkc files from the Linux kernel sources.
Must point to <tt class="docutils literal">&lt;linux <span class="pre">srctree&gt;/scripts/kconfig</span></tt>
and not just <tt class="docutils literal">&lt;linux srctree&gt;</tt>.
Can also be specified via the <tt class="docutils literal">LKCONFIG_LKC</tt> environment variable.</p>
<p class="last">Defaults to <tt class="docutils literal"><span class="pre">&lt;PRJROOT&gt;/src/lkc</span></tt>,
which contains a bundled copy of the necessary files.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--wrapper-rebuild</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Instructs the wrapper to rebuild Python modules
by passing <tt class="docutils literal"><span class="pre">--force</span></tt> to <tt class="docutils literal">setup.py build</tt>.
The wrapper tries to reuse existing modules
if this option is not given.</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="running-kernelconfig">
<h2><a class="toc-backref" href="#contents">1.3&nbsp;&nbsp;&nbsp;Running kernelconfig</a></h2>
<p>In the simplest case,
run <code>kernelconfig</code> without any arguments
from within the kernel sources directory.
It uses the <tt class="docutils literal">default</tt> <a class="reference internal" href="#settings">settings</a> and creates a <tt class="docutils literal">.config</tt> file.</p>
<!-- N.B:

==comment== only works if $PWD is the top-level kernel source directory -->
<p>It is also possible to specify the kernel sources directory by hand,
creating the <tt class="docutils literal">.config</tt> file in this directory:</p>
<pre class="literal-block">
$ kernelconfig -k /usr/src/linux
</pre>
<p>Or write the configuration to a different output file:</p>
<pre class="literal-block">
$ kernelconfig -O ./my_config
</pre>
<p>Instead of using a <em>configuration source</em>,
an input config file can be given on the command line:</p>
<pre class="literal-block">
$ kernelconfig --config ./my_config
</pre>
<p>The input and output config file can point to the same file.
Prior to writing the output file,
a backup of the old file is created (<tt class="docutils literal"><span class="pre">&lt;output&gt;.bak</span></tt>).</p>
<p>The target architecture is usually determined by <tt class="docutils literal">uname <span class="pre">-m</span></tt>.
For cross-compilation scenarios, it is possible to specify it manually:</p>
<pre class="literal-block">
$ kernelconfig -a arm
</pre>
<p>To get an overview over which <em>configuration sources</em> are available,
kernelconfig offers a few helper commands.</p>
<p>To get a list of all known <em>configuration sources</em>, run:</p>
<pre class="literal-block">
$ kernelconfig --list-source-names
</pre>
<p>or:</p>
<pre class="literal-block">
$ kernelconfig --list-sources
</pre>
<p>This list includes unvailable sources,
e.g. sources that do not support the target architecture.</p>
<p>To print out help messages for all available sources, run:</p>
<pre class="literal-block">
$ kernelconfig --help-sources
</pre>
<p>To print out the help message for a particular source,
and also report why the source is unavailable (if it is unavailable),
e.g. for Fedora, run:</p>
<pre class="literal-block">
$ kernelconfig --help-source Fedora -a mips
</pre>
<p id="usual-options">kernelconfig accepts a number of options:</p>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-h</span>, <span class="option">--help</span></kbd></td>
<td>Print the help message and exit.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--usage</span></kbd></td>
<td>Print the usage message and exit.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-V</span>, <span class="option">--print-version</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Print the version and exit.</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-q</span>, <span class="option">--quiet</span></kbd></td>
<td><p class="first">Decrease the console log level.</p>
<p class="last">This option can be given multiple times,
each time it decreases the log level by 1,
and the effective log level is calculated using
<tt class="docutils literal">WARNING + (quiet - verbose)</tt> (higher level means less verbosity).</p>
</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-v</span>, <span class="option">--verbose</span></kbd></td>
<td><p class="first">Increase the console log level.</p>
<p class="last">Can be specified more than once, see <tt class="docutils literal"><span class="pre">--quiet</span></tt> for details.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-a <var>&lt;arch&gt;</var></span>, <span class="option">--arch <var>&lt;arch&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Target architecture,
defaults to the system's architecture as returned by <tt class="docutils literal">uname <span class="pre">-m</span></tt>.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-k <var>&lt;srctree&gt;</var></span>, <span class="option">--kernel <var>&lt;srctree&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Path to the Linux kernel sources directory.</p>
<p class="last">Defaults to the current working directory.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-s <var>&lt;settings&gt;</var></span>, <span class="option">--settings <var>&lt;settings&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Path to or name of the <a class="reference internal" href="#settings-file">settings file</a>.</p>
<p>Files can be specified with an absolute path
or a relative path starting with <tt class="docutils literal">./</tt>.</p>
<p>Otherwise, <tt class="docutils literal">&lt;settings&gt;</tt> refers to a settings file in one of the
<a class="reference internal" href="#settings-directories">settings directories</a>.</p>
<p class="last">Defaults to &quot;default&quot;.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--config <var>&lt;file&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">An input configuration file that should be used
instead of the source configured in the settings file.</p>
<p class="last">Not set by default.</p>
</td></tr>
<tr><td class="option-group">
<kbd><span class="option">-I <var>&lt;file&gt;</var></span></kbd></td>
<td><p class="first">File with additional kernel configuration modifications.
The file format is identical to the that of the <a class="reference internal" href="#options">[options]</a> section
of the settings file, which also allows <tt class="docutils literal">.config</tt> snippets.</p>
<p class="last">Can be specified more than once. Not set by default.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-O <var>&lt;file&gt;</var></span>, <span class="option">--outconfig <var>&lt;file&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">The output .config file.</p>
<p class="last">Defaults to <tt class="docutils literal"><span class="pre">&lt;srctree&gt;/.config</span></tt>.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-H <var>&lt;file&gt;</var></span>, <span class="option">--hwdetect <var>&lt;file&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Enable hardware detection and read the information from a <em>hwinfo</em> file
as created by <a class="reference internal" href="#hwcollector">hwcollector</a>.</p>
<p>Disables any other hardware detection,
in particular <tt class="docutils literal">hwdetect</tt> instructions in the <a class="reference internal" href="#options">[options]</a> section
of the settings file.</p>
<p class="last">Not set by default.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-m <var>&lt;mod_dir&gt;</var></span>, <span class="option">--modules-dir <var>&lt;mod_dir&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">The <a class="reference internal" href="#modalias-information-source">modalias information source</a>
which is used for modaliased-based hardware detection.
It can be</p>
<ul class="simple">
<li>a path to a directory, e.g. <tt class="docutils literal"><span class="pre">/lib/$(uname</span> <span class="pre">-r)/modules</span></tt></li>
<li>a path to a tarball file</li>
<li><tt class="docutils literal">none</tt>,
which disables modalias-based hardware detection completely</li>
<li><tt class="docutils literal">auto</tt>,
which requires a cached <em>modalias information source</em>
that has previously been created with <tt class="docutils literal"><span class="pre">--generate-modalias</span></tt>.</li>
<li><tt class="docutils literal">optional</tt>,
which uses a cached <em>modalias information source</em> if there is one
available, and otherwise disables modalias-based hardware detection</li>
</ul>
<p class="last">Defaults to <tt class="docutils literal">optional</tt>.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--unsafe-modalias</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Controls how strict cache searching is
for <tt class="docutils literal"><span class="pre">--modules-dir</span> auto</tt> and <tt class="docutils literal">optional</tt>.
If this option is given, less compatible <em>modalias information sources</em>
are allowed if no better candidates exist.</p>
<p class="last">The default behavior is <tt class="docutils literal"><span class="pre">--safe</span></tt>.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--safe-modalias</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Forbid use of unsafe <em>modalias information sources</em>.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--generate-config</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Generate a kernel configuration. This is the default mode.</td></tr>
</tbody>
</table>
<table class="docutils option-list" frame="void" id="generate-modalias" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--generate-modalias</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Create a <em>modalias information source</em> and store it in the cache directory.
It can then be used for modalias-based hardware detection
in subsequent runs, or shared with others.</p>
<div class="warning last">
<p class="first admonition-title">Warning</p>
<p><em>modalias information source</em> involves building all kernel modules
with an <tt class="docutils literal">allmodconfig</tt> configuration, which takes a lot of time
and about 2GiB of temporary disk space.
kernelconfig will try to use <tt class="docutils literal">/var/tmp</tt> if <tt class="docutils literal">/tmp</tt> does not have
enough free space, and <tt class="docutils literal"><span class="pre">--modalias-build-dir</span></tt> can be used
to specify an alternate build root directory.</p>
<p class="last">By default, up to <tt class="docutils literal">number of CPU cores</tt> build jobs are used
for compiling, this can be adjusted with <tt class="docutils literal"><span class="pre">--jobs</span></tt>.</p>
</div>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-j <var>&lt;numjobs&gt;</var></span>, <span class="option">--jobs <var>&lt;numjobs&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Allow up to <tt class="docutils literal">&lt;numjobs&gt;</tt> build jobs when building modules.</p>
<p class="last">Defaults to the number of processor cores.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--modalias-build-dir <var>&lt;dir&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Alternative build root directory for <em>modalias information source</em>
building.
kernelconfig creates a temporary subdirectory within this directory,
and cleans it up on exit.</p>
<p class="last">By default, building takes place in <tt class="docutils literal">/tmp</tt> or <tt class="docutils literal">$TMPDIR</tt>, if set.
<tt class="docutils literal">/var/tmp</tt> is used as fallback
if <tt class="docutils literal">/tmp</tt> does not have enough free space.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--print-installinfo</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">List the directory paths where kernelconfig looks for settings,
include files, configuration sources, cached and data files,
alongside with their overall status (exists/missing).</p>
<p>The paths are grouped (<tt class="docutils literal">settings:</tt>, <tt class="docutils literal">include</tt> a.s.o.),
and are printed in descending order of priority.</p>
<p class="last">No configuration file is generated when this mode is requested.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--list-source-names</span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">List the names of all known configuration sources.
The information is based on file-exists checks and may be inaccurate.</p>
<p class="last">No configuration file is generated when this mode is requested.</p>
</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--list-sources</span></kbd></td>
<td><p class="first">List the names of all known configuration sources
alongside with their filesystem path.
The information is based on file-exists checks and may be inaccurate.</p>
<p class="last">No configuration file is generated when this mode is requested.</p>
</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--help-sources</span></kbd></td>
<td><p class="first">Print out help messages for all supported configuration sources
that did successfully load.
The information is accurate,
but varies depending on which <tt class="docutils literal"><span class="pre">--arch</span></tt> has been specified.</p>
<p class="last">No configuration file is generated when this mode is requested.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--help-source <var>&lt;name&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">Print out the help message for a single configuration source
if it is supported and did successfully load.
Otherwise, print out why it is unavailable.</p>
<p class="last">No configuration file is generated when this mode is requested.</p>
</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--script-mode <var>&lt;mode&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td><p class="first">As an alternative to the options above,
the script mode can be given via this option.</p>
<p><tt class="docutils literal">&lt;mode&gt;</tt> must be either
<tt class="docutils literal"><span class="pre">generate-config</span></tt>,
<tt class="docutils literal"><span class="pre">generate-modalias</span></tt>,
<tt class="docutils literal"><span class="pre">list-source-names</span></tt>, <tt class="docutils literal"><span class="pre">list-sources</span></tt>, or <tt class="docutils literal"><span class="pre">help-sources</span></tt>.</p>
<p class="last"><tt class="docutils literal"><span class="pre">help-source</span></tt> can not be specified with this option.</p>
</td></tr>
</tbody>
</table>
</div>
<div class="section" id="settings-file">
<span id="settings"></span><h2><a class="toc-backref" href="#contents">1.4&nbsp;&nbsp;&nbsp;Settings File</a></h2>
<p>The settings file is kernelconfig's main configuration file.
It is an <tt class="docutils literal">.ini</tt>-like file consisting of several sections.</p>
<p>Comment lines start with a <tt class="docutils literal">#</tt> char,
empty lines and most whitespace are ignored.</p>
<p>Sections are introduced with <tt class="docutils literal">[&lt;section name&gt;]</tt>, e.g. <tt class="docutils literal">[source]</tt>.
Unknown sections are ignored.
The format inside each section varies, the following table gives
a quick overview of all sections and their respective format:</p>
<table border="1" class="docutils">
<caption>settings file sections</caption>
<colgroup>
<col width="24%" />
<col width="24%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">section name</th>
<th class="head">section format</th>
<th class="head">short description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>source</td>
<td>command
+ text data</td>
<td>input <tt class="docutils literal">.config</tt></td>
</tr>
<tr><td>options</td>
<td>macros</td>
<td><tt class="docutils literal">.config</tt> modifications</td>
</tr>
</tbody>
</table>
<div class="section" id="settings-directories">
<h3><a class="toc-backref" href="#contents">1.4.1&nbsp;&nbsp;&nbsp;Settings Directories</a></h3>
<p>Settings files are usually given by name and are searched for in some
standard directories. The list of these directories varies depending
on whether kernelconfig has been installed or is run in standalone mode.</p>
<p>If kernelconfig has been installed, the directories are as follows:</p>
<pre class="literal-block">
$HOME/.config/kernelconfig
/etc/kernelconfig
</pre>
<p>In <em>standalone</em> mode, the settings directories are:</p>
<pre class="literal-block">
$HOME/.config/kernelconfig
&lt;prjroot&gt;/local/config
&lt;prjroot&gt;/config
</pre>
<p>The directories are searched in the order as listed,
and searching stops immediately if a file with the requested name is found.</p>
<p>Settings files should never be named <tt class="docutils literal">include</tt> or <tt class="docutils literal">data</tt>,
these names are reserved for other purposes.</p>
</div>
<div class="section" id="source">
<h3><a class="toc-backref" href="#contents">1.4.2&nbsp;&nbsp;&nbsp;[source]</a></h3>
<p>The <tt class="docutils literal">[source]</tt> section is used to declare
the input kernel configuration file.
If a config file has been specified with the <tt class="docutils literal"><span class="pre">--config</span></tt> option,
then the section is ignored.</p>
<p>kernelconfig needs a <em>configuration basis</em> to operate on.
It is served by a <em>configuration source</em>
and can be a single <tt class="docutils literal">.config</tt> file or multiple files</p>
<p>The first non-comment, non-empty line specifies the <em>configuration source</em>.
It starts with a keyword describing the source's type,
which can be a local file,
a remote file that can be downloaded via http(s) or ftp,
a <tt class="docutils literal">make defconfig</tt> target, a command or a script,
and is followed by arguments such as the file path.
The type keyword can be omitted
if the specified configuration source is unambiguous.</p>
<p>It can also point to a <em>curated source</em>,
which is a <em>configuration source</em> that exists separately from the settings
file, in the <tt class="docutils literal">sources</tt> subdirectory of the settings directories.
Curated sources behave similar to commands in that they accept parameters,
but their execution, especially argument parsing,
is controlled by kernelconfig.</p>
<p>Except for <em>curated sources</em>,
the <em>configuration source</em> line gets string-formatted,
see the examples below, or <a class="reference external" href="https://docs.python.org/3/library/string.html#format-string-syntax">Python String Formatting</a>.
While this allows for some variance in file paths and commands,
it also requires to escape <tt class="docutils literal">{</tt> and <tt class="docutils literal">}</tt> characters,
especially for shell scripts.
<tt class="docutils literal">${var}</tt> needs to be written as <tt class="docutils literal"><span class="pre">${{var}}</span></tt>, for instance.</p>
<p>Line continuation can be used to split long commands over multiple lines,
with a backslash <tt class="docutils literal">\\</tt> at the end each line except for the last one.</p>
<p>Subsequent non-comment lines form the source's data.
Whether the data subsection is subject to string formatting or not depends on
the configuration source type.
Only script-type configuration sources accept non-empty data.</p>
<div class="section" id="using-a-curated-source">
<h4><a class="toc-backref" href="#contents">1.4.2.1&nbsp;&nbsp;&nbsp;Using a curated source</a></h4>
<p>Example:</p>
<pre class="literal-block">
[source]
ubuntu --lowlatency
</pre>
<p>Curated sources are referenced by their name,
which is case-insensitive <a class="footnote-reference" href="#id3" id="id2">[*]</a>.
Their type keyword is <tt class="docutils literal">source</tt>, it can be omitted
unless the source's name itself is a keyword.</p>
<table class="docutils footnote" frame="void" id="id3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[*]</a></td><td>names are converted to lowercase before searching for the source</td></tr>
</tbody>
</table>
<p>Curated sources usually accept a few parameters
for selecting the configuration basis variant.</p>
<p>As outlined before, kernelconfig has more control over curated sources
than over configuration sources specified in the settings file.
For example, kernelconfig checks whether the target architecture is
supported by the source, and refuses to continue if not.</p>
<p>Run <tt class="docutils literal">kernelconfig <span class="pre">--list-sources</span></tt>
to get a list of potential curated source names.
and <tt class="docutils literal">kernelconfig <span class="pre">--help-source</span> &lt;name&gt;</tt>
provides information about a particular source, including its parameters.</p>
<p>Currently, the following curated sources are available:</p>
<p>CentOS</p>
<blockquote>
<p>Supported architectures: ppc64, ppc64le, s390x, x86, x86_64</p>
<p>Parameters:</p>
<blockquote>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--debug</span></kbd></td>
<td>Use the <tt class="docutils literal"><span class="pre">-debug</span></tt> config variant</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--release</span></kbd></td>
<td>CentOS has per OS-release git branches that correspond to
a specific kernel version.
By default, the configuration source tries to identify
the best-fitting branch, but this option can be used to override
the auto detection.</td></tr>
</tbody>
</table>
</blockquote>
</blockquote>
<p>Debian</p>
<blockquote>
<p>Supported architectures: x86, x86_64</p>
<p>Parameters:</p>
<blockquote>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--flavour <var>&lt;flavour&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>Debians kernel ecosystem distinguishes between specialized
variants of architectures, so-called <em>flavours</em>,
which can be specified with this option.</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">--featureset <var>&lt;featureset&gt;</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>For some architectures, Debian has config variants that
enable an additional feature.
Supported feature sets depend on the target architecture
and <tt class="docutils literal"><span class="pre">--flavour</span></tt>.
Possible values are <tt class="docutils literal">rt</tt>, <tt class="docutils literal">none</tt> and the empty string.</td></tr>
</tbody>
</table>
</blockquote>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">The supported architectures mapping for Debian is incomplete.
The underlying script is able to handle other architectures
(it has been tested with various mips arch flavours).</p>
</div>
</blockquote>
<p>Fedora</p>
<blockquote>
<p>Supported architectures:
aarch64, arm, arm64, armv7hl, s390, s390x, x86, x86_64</p>
<p>Parameters:</p>
<blockquote>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--pae</span></kbd></td>
<td>Use the config variant with support for
Physical Address Extensions (32-bit x86 only)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--lpae</span></kbd></td>
<td>Use config variant with support for
Large Physical Address Extensions (arm only)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--debug</span></kbd></td>
<td>Use the <tt class="docutils literal"><span class="pre">-debug</span></tt> config variant</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--release</span></kbd></td>
<td>Fedora has per OS-release git branches that correspond to
a specific kernel version.</td></tr>
</tbody>
</table>
</blockquote>
</blockquote>
<p>Liquorix</p>
<blockquote>
<p>Supported architectures: x86, x86_64</p>
<p>Parameters:</p>
<blockquote>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--pae</span></kbd></td>
<td>Use the config variant with support for
Physical Address Extensions (32-bit x86 only)</td></tr>
</tbody>
</table>
</blockquote>
</blockquote>
<p>Ubuntu</p>
<blockquote>
<p>Supported architectures: arm64, armhf, x86, x86_64</p>
<p>Parameters:</p>
<blockquote>
<table class="docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">--lowlatency</span></kbd></td>
<td>Use the low-latency config variant (x86, x86_64 only)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--generic</span></kbd></td>
<td>Use the generic config variant (which is the default)</td></tr>
<tr><td class="option-group">
<kbd><span class="option">--lpae</span></kbd></td>
<td>Use config variant with support for
Large Physical Address Extensions (arm only)</td></tr>
</tbody>
</table>
</blockquote>
</blockquote>
</div>
<div class="section" id="using-defconfig-as-configuration-source">
<h4><a class="toc-backref" href="#contents">1.4.2.2&nbsp;&nbsp;&nbsp;Using defconfig as configuration source</a></h4>
<p>Run <tt class="docutils literal">make defconfig</tt> with a temporary directory
as output directory, and use the generated file as input config file:</p>
<pre class="literal-block">
[source]
defconfig
</pre>
<p>The type keyword is <tt class="docutils literal">defconfig</tt>, and no parameters are accepted.</p>
</div>
<div class="section" id="using-a-file-as-configuration-source">
<h4><a class="toc-backref" href="#contents">1.4.2.3&nbsp;&nbsp;&nbsp;Using a file as configuration source</a></h4>
<p>Use a local file named <tt class="docutils literal">config_&lt;arch&gt;</tt> found in the <tt class="docutils literal">sources/files</tt>
subdirectory of the settings directories:</p>
<pre class="literal-block">
[source]
file config_{arch}
</pre>
<p>It is also possible to download file via http/https/ftp, for example:</p>
<pre class="literal-block">
[source]
http://.../{kv}/config.{arch}
</pre>
<p>Absolute file paths and file uris starting with <tt class="docutils literal"><span class="pre">file://</span></tt>
are understood, too.</p>
<p>The type keyword is <tt class="docutils literal">file</tt> and it can be omitted for absolute file paths
and file uris,
but not for relative file paths as that interferes with curated sources.</p>
<p>Besides the file path, no other parameters are accepted.
The path is subject to basic <a class="reference internal" href="#string-formatting">string formatting</a>.</p>
</div>
<div class="section" id="using-a-command-as-configuration-source">
<h4><a class="toc-backref" href="#contents">1.4.2.4&nbsp;&nbsp;&nbsp;Using a command as configuration source</a></h4>
<p>Example:</p>
<pre class="literal-block">
[source]
command wget http://... -O {outconfig}
</pre>
<p>The type keyword is <tt class="docutils literal">command</tt> or alternatively <tt class="docutils literal">cmd</tt>,
and it can not be omitted.</p>
<p>All arguments after the keyword are subject to <a class="reference internal" href="#string-formatting">string formatting</a>,
automatic format variables are supported.
Additionally, commands have to access to the
<a class="reference internal" href="#config-source-environment-variables">config source environment variables</a>.</p>
<p>The initial working directory is a temporary directory
which is cleaned up by kernelconfig.
If no config file is referenced via
the automatic <tt class="docutils literal">{outconfig}</tt>, <tt class="docutils literal">{out}</tt> format variables,
kernelconfig expects that the command
creates a <tt class="docutils literal">config</tt> file in the temporary directory.</p>
</div>
<div class="section" id="using-a-script-as-configuration-source">
<h4><a class="toc-backref" href="#contents">1.4.2.5&nbsp;&nbsp;&nbsp;Using a script as configuration source</a></h4>
<p>Download a tarball,
extract it to a temporary directory,
and pick some of its files as input config:</p>
<pre class="literal-block">
[source]
sh
wget http://.../file.tgz
tar xf file.tgz -C '{T0}'
cp '{T0}/config.common' '{out}'
for a in {arch} {karch} _; do
    if [ &quot;$a&quot; = &quot;_&quot; ]; then
        exit 1
    elif [ -e &quot;{T0}/config.$a&quot; ]; then
        cat &quot;{T0}/config.$a&quot; &gt;&gt; '{out}'
        break
    fi
done
</pre>
<p>The type keyword is <tt class="docutils literal">sh</tt> for shell scripts,
which are run in errexit mode (<tt class="docutils literal">set <span class="pre">-e</span></tt>).</p>
<p>The data subsection contains the script, and it must not be empty.</p>
<p>The script is subject to <a class="reference internal" href="#string-formatting">string formatting</a>,
automatic format variables are supported.
Additionally, the script has access to the
<a class="reference internal" href="#config-source-environment-variables">config source environment variables</a>.</p>
<p>The initial working directory is a temporary directory
which is cleaned up by kernelconfig.
If no config file is referenced via
the automatic <tt class="docutils literal">{outconfig}</tt>, <tt class="docutils literal">{out}</tt> format variables,
kernelconfig expects that the script
creates a <tt class="docutils literal">config</tt> file in the temporary directory.</p>
</div>
<div class="section" id="configuration-source-environment-variables">
<span id="config-source-environment-variables"></span><h4><a class="toc-backref" href="#contents">1.4.2.6&nbsp;&nbsp;&nbsp;Configuration Source Environment Variables</a></h4>
<p>Commands, including scripts,
have access to the following environment variables:</p>
<table border="1" class="docutils">
<caption>configuration source environment variables</caption>
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">name</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>S</td>
<td rowspan="2">path to the kernel sources</td>
</tr>
<tr><td>SRCTREE</td>
</tr>
<tr><td>T</td>
<td>private temporary directory</td>
</tr>
<tr><td>TMPDIR</td>
<td>temporary directory
(same as <tt class="docutils literal">T</tt>)</td>
</tr>
<tr><td>ARCH</td>
<td>target architecture as specified
on the command line, or <tt class="docutils literal">$(uname <span class="pre">-m)</span></tt></td>
</tr>
<tr><td>KARCH</td>
<td><p class="first">target kernel architecture</p>
<p class="last">For instance, if <tt class="docutils literal">ARCH</tt> is <tt class="docutils literal">x86_64</tt>,
<tt class="docutils literal">KARCH</tt> would be <tt class="docutils literal">x86</tt>.</p>
</td>
</tr>
<tr><td>SUBARCH</td>
<td><p class="first"><em>underlying kernel architecture</em></p>
<p class="last">Usually equal to <tt class="docutils literal">KARCH</tt>.</p>
</td>
</tr>
<tr><td>SRCARCH</td>
<td><p class="first">target kernel source architecture</p>
<p class="last">Usually equal to <tt class="docutils literal">KARCH</tt>.</p>
</td>
</tr>
<tr><td>KVER</td>
<td>full kernel version, e.g.
<tt class="docutils literal"><span class="pre">4.7.0-rc1</span></tt>, <tt class="docutils literal">3.0.0</tt>, <tt class="docutils literal">4.5.1</tt></td>
</tr>
<tr><td>KV</td>
<td>full kernel version without patchlevel
unless it is an <tt class="docutils literal"><span class="pre">-rc</span></tt> version,
e..g <tt class="docutils literal"><span class="pre">4.7.0-rc1</span></tt>, <tt class="docutils literal">3.0</tt>, <tt class="docutils literal">4.5</tt></td>
</tr>
<tr><td>KMAJ</td>
<td>kernel version,
e.g. <tt class="docutils literal">4</tt>, <tt class="docutils literal">3</tt>, <tt class="docutils literal">4</tt></td>
</tr>
<tr><td>KPATCH</td>
<td>kernel version patchlevel,
e.g. <tt class="docutils literal">7</tt>, <tt class="docutils literal">0</tt>, <tt class="docutils literal">5</tt></td>
</tr>
<tr><td>KMIN</td>
<td>kernel version sublevel,
e.g. <tt class="docutils literal">0</tt>, <tt class="docutils literal">0</tt>, <tt class="docutils literal">1</tt></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configuration-source-format-variables">
<span id="string-formatting"></span><h4><a class="toc-backref" href="#contents">1.4.2.7&nbsp;&nbsp;&nbsp;Configuration Source Format Variables</a></h4>
<p>All basic source types are subject to Python string formatting.</p>
<p>The available format variables are identical to the environment variables,
except for <tt class="docutils literal">TMPDIR</tt> (not set) and  <tt class="docutils literal">T</tt> (special, see below).
Unlike the environment variables, the names of format variables
are case-insensitive, e.g. both <tt class="docutils literal">{kv}</tt> and <tt class="docutils literal">{KV}</tt> are accepted.</p>
<p>Additionally, the <tt class="docutils literal">script</tt> and <tt class="docutils literal">command</tt> type config sources
support <em>automatic format variables</em>,
which can be used to request additional temporary directories and files
and to tell kernelconfig where the <tt class="docutils literal">.config</tt> file(s) can be found
after processing the configuration source,
without having to specify a filesystem path.</p>
<p>There is no guarantee that filesystem paths produced by automatic format
variables do not require quoting in e.g. shell scripts,
so make sure to quote the automatic variables where appropriate.</p>
<p><em>Automatic format variables</em> start with a keyword
and are optionally followed by an integer identifier,
which can be used to request additional files of the same type.</p>
<p>The following variables exist:</p>
<dl class="docutils">
<dt><tt class="docutils literal">outconfig</tt> or <tt class="docutils literal">out</tt></dt>
<dd><p class="first">Request a temporary file
and tell kernelconfig that it will be part of the configuration basis.</p>
<p class="last">The identifier can be used to request additional files.
Note that <tt class="docutils literal">{out}</tt> and <tt class="docutils literal">{outconfig}</tt> will point to distinct files,
and so do <tt class="docutils literal">{out},&nbsp; {out0}, {out00}, <span class="pre">...,</span> {out9}, ...</tt>.</p>
</dd>
<dt><tt class="docutils literal">outfile</tt></dt>
<dd><p class="first">Request a temporary file
that will not be part of the configuration basis.</p>
<p class="last">Otherwise, identical to <tt class="docutils literal">outconfig</tt>.</p>
</dd>
<dt><tt class="docutils literal">T</tt></dt>
<dd><p class="first">Request a temporary directory.</p>
<p class="last">If used without an identifier, request the default private tmpdir.
If used with an identifier, creates a new directory.</p>
</dd>
</dl>
</div>
</div>
<div class="section" id="options">
<h3><a class="toc-backref" href="#contents">1.4.3&nbsp;&nbsp;&nbsp;[options]</a></h3>
<p>The <tt class="docutils literal">[options]</tt> section should contain a list of config-modifying commands:</p>
<pre class="literal-block">
disable            A
builtin            B
module             C
builtin-or-module  D E F

set                G &quot;value&quot;
append             H &quot;value&quot;
add                I &quot;value&quot;
</pre>
<p>Config option names are case-insensitive
and the <tt class="docutils literal">CONFIG_</tt> prefix can be omitted.
The first group of commands accepts an arbitrary non-zero
number of config options.</p>
<!-- N.B: kernel sources only:: -->
<p>Config options can also be referenced by their module name, for example:</p>
<pre class="literal-block">
builtin-or-module module ddbridge   # enables DVB_DDBRIDGE
</pre>
<p><a class="reference internal" href="#hardware-detection">Hardware detection</a> can be requested with <tt class="docutils literal">hwdetect</tt>, however
it has no effect if the <tt class="docutils literal"><span class="pre">--hwdetect</span></tt> option is passed to kernelconfig:</p>
<pre class="literal-block">
hwdetect
</pre>
<p>Config recommendations from installed packages can be requested with
<tt class="docutils literal">packages</tt>.
The recommendations can be based on what was present at package build-time:</p>
<pre class="literal-block">
packages build-time
</pre>
<p>or re-evaluated against the kernel sources for which a configuration
is being created:</p>
<pre class="literal-block">
packages
# packages re-eval  # alternatively
</pre>
<p>It also possible to load so-called <em>feature set</em> files:</p>
<pre class="literal-block">
include  feature
include  feature-dir/*
include  /path/to/feature/file
</pre>
<p>The format of <em>feature set</em> files is identical
to that of the <tt class="docutils literal">[options]</tt> section.
Basically, settings files can be viewed as extended <em>feature set</em> files.</p>
<p>Relative file paths are looked up in the <tt class="docutils literal">include</tt> subdirectories
of the <a class="reference internal" href="#settings-directories">settings directories</a>.
Globbing is supported and expands to a combined list of glob matches
from all directories, but with the usual order of preference.</p>
<p>See <a class="reference external" href="macros_lang.rst">macros file format</a> for a more detailed explanation of the format.</p>
</div>
</div>
<div class="section" id="hardware-detection">
<h2><a class="toc-backref" href="#contents">1.5&nbsp;&nbsp;&nbsp;Hardware Detection</a></h2>
<p>kernelconfig is able to determine which hardware is present on the system
and enable config options accordingly.</p>
<p>This feature can be requested with <tt class="docutils literal">hwdetect</tt> in the <a class="reference internal" href="#options">[options]</a> section
of the settings file, or with the <tt class="docutils literal"><span class="pre">--hwdetect</span> &lt;file&gt;</tt> command line option.
The latter is meant for
<a class="reference internal" href="#collecting-hardware-information-on-a-different-machine">collecting hardware information on a different machine</a>.</p>
<p>In either case, it relies on at least one <em>hardware information source</em>
and a mapping from hardware identifiers to config options,
which is created at runtime from the kernel sources being processed.</p>
<p>Two different <em>hardware information source</em> are available:</p>
<ul class="simple">
<li><strong>driver</strong>
- detect which kernel modules are currently used by any device</li>
<li><strong>modalias</strong>
- detect kernel modules for all device via module alias identifiers</li>
</ul>
<p>kernelconfig uses whatever source is available
and potentially both <em>driver</em>- and <em>modalias</em>-based detection.
The hardware identifiers are translated into config options,
which are enabled as <em>builtin</em> or <em>module</em>, and <em>module</em> is preferred.</p>
<p>If hardware detection has been requested and at least one hardware identifier
has been found but no config options could be determined,
then hardware detection is considered to have failed.</p>
<p><strong>driver</strong>-based hardware detection has no special requirements except
that modules for ideally all devices must be present and loaded (or builtin).
This can work sufficiently well when a &quot;big&quot; kernel has been booted
and a kernel configuration is being created for the same machine.</p>
<p>Otherwise, <strong>modalias</strong>-based hardware detection provides a more accurate
selection of config options that also includes options for unknown devices,
but requires a <em>modalias information source</em>.</p>
<div class="section" id="modalias-information-source">
<h3><a class="toc-backref" href="#contents">1.5.1&nbsp;&nbsp;&nbsp;Modalias Information Source</a></h3>
<p>A <em>modalias information source</em> is, basically, a very reduced variant
of a modules directory that would normally be installed to <tt class="docutils literal">/lib/modules</tt>.
The most important file provided by this source is <tt class="docutils literal">modules.alias</tt>,
a <em>ideally complete</em> mapping from module alias identifiers to modules.</p>
<p><em>modalias information sources</em> as used by kernelconfig can be directories,
but are usually xz-compressed tarballs that are kept in the
<em>modalias cache directory</em>, <tt class="docutils literal"><span class="pre">$HOME/.cache/kernelconfig/modalias</span></tt>.</p>
<p>When kernelconfig is requested to locate a cached source,
it will by default only look for sources that have been built for the
same target architecture or at least for the same <tt class="docutils literal">SUBARCH</tt>.
Furthermore, the kernel version of the cached source must have the same
major version and the version difference must not exceed 8 patchlevels.
This is the so-called <em>safe</em> mode (<tt class="docutils literal"><span class="pre">--safe-modalias</span></tt>).</p>
<p>In <em>unsafe</em> mode,
the kernel's major version must be equal but is otherwise unrestricted,
and cached sources for different target architectures are considered,
though not preferred.
This mode has to be explicitly enabled with <tt class="docutils literal"><span class="pre">--unsafe-modalias</span></tt>.</p>
<p>A new <em>modalias information source</em> can be created with:</p>
<pre class="literal-block">
kernelconfig --generate-modalias -k /usr/src/linux
</pre>
<p>This will build all kernel modules using an <tt class="docutils literal">allmodconfig</tt> configuration
install them to a temporary directory, run depmod
and create a tarball with the relevant files,
which is stored in the cache directory as
<tt class="docutils literal"><span class="pre">$HOME/.cache/kernelconfig/modalias/{kernelversion}__{arch}.txz</span></tt>,
for example <tt class="docutils literal"><span class="pre">$HOME/.cache/kernelconfig/modalias/4.6.5__x86_64.txz</span></tt>.</p>
<p>The tarballs can be shared with others.
Since there is no convenient way to import shared tarballs [yet],
they have to specified with the <tt class="docutils literal"><span class="pre">--modules-dir</span></tt> option
or copied to the cache directory manually.</p>
<p>Be aware of the time and disk space requirements,
which are covered in <a class="reference internal" href="#generate-modalias">--generate-modalias</a>.</p>
</div>
<div class="section" id="collecting-hardware-information-on-a-different-machine">
<span id="hwcollector"></span><h3><a class="toc-backref" href="#contents">1.5.2&nbsp;&nbsp;&nbsp;Collecting Hardware Information on a Different Machine</a></h3>
<p>Hardware detection is not limited to the machine running kernelconfig,
it is also possible to scan for hardware identifiers on another machine.</p>
<div class="note">
<p class="first admonition-title">Note</p>
<p class="last">modalias-based hardware detection is recommended for this use case.</p>
</div>
<p>Example scenarios include booting a live system on the <em>target</em> machine,
for example SystemRescueCd, detecting its hardware and sending the information
to the <em>build</em> machine, which then feeds kernelconfig with the data.
Another example would be a minimal busybox-based initramfs booted via PXE
that serves the hardware information via netcat.</p>
<p>For this purpose, kernelconfig offers a <tt class="docutils literal">hwcollect</tt> shell script,
which can be found under <tt class="docutils literal">files/scripts/hwcollect.sh</tt>
in the project's sources.
It scans <tt class="docutils literal">/sys</tt> and creates a JSON file containing the information,
which is written to stdout,
and can be fed to kernelconfig with the <tt class="docutils literal"><span class="pre">--hwdetect</span></tt> option.</p>
<p>Under normal circumstances, the script can be run by regular users.
An exception to that is grsec <tt class="docutils literal">/sys</tt> protections.</p>
<p>If the <em>build</em> machine is able to access the <em>target</em> machine via ssh
as user <tt class="docutils literal">hwcol</tt> and the script is installed on the <em>target</em>,
the commands for generating a configuration for <em>target</em>
with hardware detection would be:</p>
<pre class="literal-block">
[build] $ ssh -l hwcol target kernelconfig-hwcollect &gt; ./hwinfo.json
[build] $ kernelconfig -H ./hwinfo.json ...
</pre>
<p>It is also possible to send the script to the target machine via ssh:</p>
<pre class="literal-block">
[build] $ cd &lt;prjroot&gt;
[build] $ &lt; ./files/scripts/hwcollect.sh ssh -l hwcol target sh &gt; ./hwinfo.json
[build] $ kernelconfig -H ./hwinfo.json ...
</pre>
<p>The script's dependencies are a few basic programs including a shell,
<tt class="docutils literal">/sys</tt> and <tt class="docutils literal">/proc</tt> mounted, and a way to transfer files from the
target machine to the build machine.</p>
<div class="section" id="hwinfo-file">
<h4><a class="toc-backref" href="#contents">1.5.2.1&nbsp;&nbsp;&nbsp;hwinfo file</a></h4>
<p>The hardware information file is a JSON object with dummy null-terminates
that lists which kernel modules and module alias identifiers have been
detected on the <em>target</em> machine:</p>
<pre class="code json literal-block">
<span class="punctuation">{</span>
    <span class="name tag">&quot;version&quot;</span><span class="punctuation">:</span> <span class="literal number integer">1</span><span class="punctuation">,</span>
    <span class="name tag">&quot;driver&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
        <span class="error">...</span><span class="punctuation">,</span>
        <span class="literal string double">&quot;&quot;</span>
    <span class="punctuation">],</span>
    <span class="name tag">&quot;modalias&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>
        <span class="error">...</span><span class="punctuation">,</span>
        <span class="literal string double">&quot;&quot;</span>
    <span class="punctuation">],</span>
    <span class="name tag">&quot;__null__&quot;</span><span class="punctuation">:</span> <span class="keyword constant">null</span>
<span class="punctuation">}</span>
</pre>
<p>The <tt class="docutils literal">version</tt> tells kernelconfig the overall structure of the JSON object,
it has to be <tt class="docutils literal">1</tt>.</p>
<p><tt class="docutils literal">driver</tt> is a list of kernel modules
that kernelconfig should enable after translating them to config options,
similar to driver-based hardware detection.</p>
<p><tt class="docutils literal">modalias</tt> is a list of module alias identifiers
that kernelconfig should enable after translating them to config options.</p>
<p><tt class="docutils literal">__null__</tt> is completely ignored, as are empty strings in lists.
JSON list/object items need to be separated with a comma,
but a comma after the last item is not allowed.
By using dummy null values,
this detail can be mostly ignored in the collector script,
with a small file size overhead of one dummy item per list/object.</p>
</div>
</div>
</div>
<div class="section" id="package-management-integration">
<h2><a class="toc-backref" href="#contents">1.6&nbsp;&nbsp;&nbsp;Package Management Integration</a></h2>
<p>Installed packages can serve as source for config option recommendations.
This feature relies on packages being managed by portage,
and can be requested with <tt class="docutils literal">packages</tt> in the <a class="reference internal" href="#options">[options]</a> section
of the settings file.</p>
<p>Two variants of <em>pm-integration</em> are available, <em>static</em> and <em>dynamic</em>,
both query the value of the <tt class="docutils literal">CONFIG_CHECK</tt> variable from installed packages,
but to a different extent.</p>
<p><em>static pm-integration</em> uses the package build-time value of <tt class="docutils literal">CONFIG_CHECK</tt>,
which can be retrieved quickly, but is not reliable,
because <tt class="docutils literal">CONFIG_CHECK</tt> could have been set conditionally,
e.g. by comparing the kernel version
against the kernel sources being present at package build time.</p>
<p>For that reason, a more reliable but also more (time-)complex solution exists,
<em>dynamic pm-integration</em>, which re-evaluates <tt class="docutils literal">CONFIG_CHECK</tt>
by running the relevant ebuild phases again.</p>
<p>Either variant transforms <tt class="docutils literal">CONFIG_CHECK</tt> into a sequence of
<em>enable option as builtin or module</em> and <em>disable option</em> config modifications.
Unknown config options listed in <tt class="docutils literal">CONFIG_CHECK</tt> are ignored.</p>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p><em>dynamic pm-integration</em> runs the <tt class="docutils literal">pkg_setup()</tt> ebuild phase
for all installed packages that inherit <tt class="docutils literal"><span class="pre">linux-info.eclass</span></tt>,
as regular user.</p>
<p>Since <tt class="docutils literal">pkg_setup</tt> can do arbitrary things like creating users,
this can fail for individual packages, in which case kernelconfig
prints a warning message  and tries to use the information gathered
from running the ebuild so far.</p>
<ol class="arabic simple">
<li>It is very unlikely that the failure is caused by kernelconfig,
more likely the ebuild is doing things in <tt class="docutils literal">pkg_setup()</tt>
that should be handled during <tt class="docutils literal">pkg_postinst()</tt> or <tt class="docutils literal">pkg_preinst()</tt></li>
<li>Do not run kernelconfig as root,
especially when using <em>dynamic pm-integration</em>!</li>
</ol>
<p class="last">For <tt class="docutils literal">enewuser/enewgroup</tt> related failures, see <a class="reference external" href="https://bugs.gentoo.org/show_bug.cgi?id=217042">Gentoo Bug #217042</a>.</p>
</div>
</div>
<div class="section" id="curated-sources">
<h2><a class="toc-backref" href="#contents">1.7&nbsp;&nbsp;&nbsp;Curated Sources</a></h2>
<p>This section covers how to add new <em>curated sources</em> to kernelconfig.</p>
<p>As previously noted,
the purpose of configuration sources is to provide a <em>configuration basis</em>,
a non-empty list of files that is used as input <tt class="docutils literal">.config</tt>.</p>
<p><em>Curated sources</em> are configuration sources
that exist separately from the settings file,
in the <tt class="docutils literal">sources</tt> subdirectory of the settings directories.</p>
<p>A curated source consists of</p>
<ul class="simple">
<li>a script <tt class="docutils literal"><span class="pre">sources/&lt;name&gt;</span></tt> (<em>script only</em>)</li>
<li>a <em>source definition file</em> <tt class="docutils literal"><span class="pre">sources/&lt;name&gt;.def</span></tt> (<em>sourcedef only</em>)</li>
<li>a <em>source definition file</em> <tt class="docutils literal"><span class="pre">sources/&lt;name&gt;.def</span></tt>
plus a script <tt class="docutils literal"><span class="pre">sources/&lt;name&gt;</span></tt> (<em>sourcedef with script</em>)
or a Python module <tt class="docutils literal"><span class="pre">sources/&lt;name&gt;</span></tt> (<em>sourcedef with pym</em>)</li>
</ul>
<div class="section" id="script-only-curated-sources">
<h3><a class="toc-backref" href="#contents">1.7.1&nbsp;&nbsp;&nbsp;Script-Only Curated Sources</a></h3>
<p>The simplest case is <em>script only</em>,
which is limited to single-file configuration bases.
Just put a script in <tt class="docutils literal"><span class="pre">&lt;settings&gt;/source</span></tt>, e.g.
<tt class="docutils literal"><span class="pre">$HOME/.config/kernelconfig/sources/my_source</span></tt>,
and make it executable.</p>
<p>It can then be referenced in the settings file with:</p>
<pre class="literal-block">
[source]
my_source
</pre>
<p>When run,
it receives a file path to which the configuration basis
should be written to as first argument,
the target architecture as second argument,
and the short kernel version (kernel version and patchlevel, e.g. <tt class="docutils literal">4.1</tt>)
as third argument.
Parameters from the settings file are passed as-is to the script,
starting at the fourth argument:</p>
<pre class="literal-block">
my_source {outconfig} {arch} {kmaj}.{kpatch} ...
</pre>
<p>The script has also access to the <a class="reference internal" href="#config-source-environment-variables">config source environment variables</a>.</p>
<p>At some point, it might be useful
to restrict the accepted architectures to what is actually supported
and provide a more meaningful help message
when <tt class="docutils literal">kernelconfig <span class="pre">--help-source</span> my_source</tt> is run.</p>
<p>This can be done by creating a <tt class="docutils literal">my_source.def</tt> source definition file
in the same directory with the following content:</p>
<pre class="literal-block">
[source]
Architectures = x86_64

# use the script-only script calling convention,
#  which passes all unknown parameters as-is to the script
PassUnknownArgs = 1

Description = my source is ...
</pre>
</div>
<div class="section" id="source-definition-file">
<h3><a class="toc-backref" href="#contents">1.7.2&nbsp;&nbsp;&nbsp;Source Definition File</a></h3>
<p>Curated sources that are not script-type sources,
or sources that want to benefit from argument parsing,
need to be described in a source definition file.</p>
<p>Source definition files reside in the same directory as scripts,
and their filename must end with <tt class="docutils literal">.def</tt>.</p>
<p id="liquorix-example">Example: Liquorix (<tt class="docutils literal">sources/liquorix.def</tt>):</p>
<pre class="literal-block">
[source]
Name = Liquorix

Architectures = x86_64 x86
Features = pae

Type = file
Path = http://liquorix.net/sources/{kmaj}.{kpatch}/config.{param_arch}{param_pae}

Description =
  Liquorix is a distro kernel replacement built using the best configuration
  and kernel sources for desktop, multimedia, and gaming workloads.

[Arch:x86_64]
Value = amd64

[Arch:x86]
Value = i386

[Feature:PAE]
Arch = x86
Value = -pae
Description = enable Physical Address Extensions ...
</pre>
<p>Liquorix supports 32-bit and 64-bit x86 architectures
and has a <tt class="docutils literal"><span class="pre">-pae</span></tt> config variant for 32-bit x86.
The config file can be downloaded via http,
and the url can be constructed with the information
from the source definition file.</p>
<p>The <tt class="docutils literal">Description</tt> options are used for creating the help message that can
be viewed with <tt class="docutils literal">kernelconfig <span class="pre">--help-source</span> liquorix</tt>.</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>The source definition file is an ini file.
Empty lines are ignored, comment lines start with <tt class="docutils literal">#</tt>,
sections are introduced with <tt class="docutils literal">[&lt;name&gt;]</tt>,
and options are set with <tt class="docutils literal">&lt;option&gt; = &lt;value&gt;</tt>.
Option and section names are case-insensitive.
Long values can span over multiple lines by indenting subsequent lines
with whitespace.</p>
<p>The <tt class="docutils literal">[source]</tt> section describes the source,
how to run it, and states which architectures and features are supported.</p>
<p>The following options are recognized in the <tt class="docutils literal">[source]</tt> section:</p>
<table border="1" class="docutils">
<caption>source definition <tt class="docutils literal">[source]</tt> section options</caption>
<colgroup>
<col width="21%" />
<col width="18%" />
<col width="13%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">field name</th>
<th class="head">value type</th>
<th class="head">required</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Name</td>
<td>str</td>
<td><em>default</em></td>
<td><p class="first">Name of the curated source</p>
<p class="last">Defaults to the name of the
definition file (file suffix removed)</p>
</td>
</tr>
<tr><td>Description</td>
<td>str</td>
<td>no</td>
<td>Description of the curated source,
for informational purposes</td>
</tr>
<tr><td>Type</td>
<td>str</td>
<td><em>depends</em></td>
<td><p class="first">The type of the source,
which can be</p>
<ul class="simple">
<li>file</li>
<li>script</li>
<li>pym</li>
<li>command</li>
<li>make</li>
</ul>
<p>If not set, kernelconfig tries to
autodetect the type:</p>
<ul class="last simple">
<li><em>script</em> if <tt class="docutils literal">Path=</tt> is set,
or if a file with the source's
name was found in the <tt class="docutils literal">sources</tt>
directory,</li>
<li><em>command</em> if <tt class="docutils literal">Command=</tt> is set
and does not reference the
<tt class="docutils literal">{script_file}</tt> format variable</li>
</ul>
</td>
</tr>
<tr><td>Path</td>
<td>format str</td>
<td><em>depends</em></td>
<td><p class="first">For file-type sources, this is the
path to the config file and required.</p>
<p>For script- and pym-type sources,
this is the path to the script
or Python module, and optional.
It defaults to
<tt class="docutils literal">&lt;settings <span class="pre">dirs&gt;/sources/&lt;name&gt;</span></tt></p>
<p class="last">Ignored for command and make.</p>
</td>
</tr>
<tr><td><p class="first">Command</p>
<p class="last"><em>also</em>: Cmd</p>
</td>
<td>format str</td>
<td><em>depends</em></td>
<td><p class="first">For command-type sources,
this field specifies the command
to be run and is mandatory.</p>
<p>For script-type sources,
this field can be used to override
the calling convention.
It should include <tt class="docutils literal">{script_file}</tt>,
which gets replaced with the
script specified in <tt class="docutils literal">Path</tt></p>
<p class="last">For make-type sources,
this field can be used to pass
additional arguments to the
<tt class="docutils literal">make</tt> command.</p>
</td>
</tr>
<tr><td>Target</td>
<td>str</td>
<td>yes</td>
<td>Target for make-type sources</td>
</tr>
<tr><td><p class="first">Architectures</p>
<p class="last"><em>also</em>: Arch</p>
</td>
<td>str-list</td>
<td>no</td>
<td><p class="first">List of supported architectures</p>
<p class="last">Defaults to <em>all</em>.</p>
</td>
</tr>
<tr><td><p class="first">Features</p>
<p class="last"><em>also</em>: Feat</p>
</td>
<td>str-list</td>
<td>no</td>
<td><p class="first">List of source variants</p>
<p class="last">Defaults to none (the empty string).</p>
</td>
</tr>
<tr><td>PassUnknownArgs</td>
<td>bool</td>
<td>no</td>
<td><p class="first">Controls whether unknown parameters
should be accepted. By default,
kernelconfig refuses to operate when
unknown parameters are encountered.</p>
<p class="last">For script-type sources,
the unknown parameters are passed
as-is after <tt class="docutils literal">Command</tt>.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>If a list of supported architectures is specified,
all other architectures are considered unsupported for a particular source,
and kernelconfig refuses to operate.</p>
<p>Since naming of target architectures varies between sources,
<tt class="docutils literal"><span class="pre">[Arch:&lt;name&gt;]</span></tt> sections can be used to provide a name mapping.
They only have one option, <tt class="docutils literal">Value</tt>, which sets the alternative name.</p>
<p>For example, <tt class="docutils literal">x86_64</tt> is often named <tt class="docutils literal">amd64</tt>:</p>
<pre class="literal-block">
[Arch:x86_64]
Value = amd64
</pre>
<p>The <em>architecture-rename</em> sections are tried to match
with the most specific arch first (<tt class="docutils literal">$(uname <span class="pre">-r)</span></tt>, e.g. <tt class="docutils literal">x86_64</tt>),
and the most generic arch last (kernel arch, e.g. <tt class="docutils literal">x86</tt>).</p>
<p>For renaming <tt class="docutils literal">x86</tt> to <tt class="docutils literal">i386</tt>, it is necessary to provide an empty
rename section for <tt class="docutils literal">x86_64</tt> since the kernel architecture
is <tt class="docutils literal">x86</tt> in both cases:</p>
<pre class="literal-block">
[Arch:x86]
Value = i386

[Arch:x86_64]
#Value = x86_64
</pre>
<p>Supported architectures can also be listed with the <tt class="docutils literal">Architectures</tt> option
in the <tt class="docutils literal">[source]</tt> section.</p>
<p>The renamed architecture is available via the <tt class="docutils literal">{param_arch}</tt>
format variable.
If rename action has been taken, <tt class="docutils literal">{param_arch}</tt> equals <tt class="docutils literal">{arch}</tt>.</p>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>Each curated source has an argument parser that verifies and processes
the parameters it receives from the settings file.</p>
<p>By default, no parameters are accepted, unless <tt class="docutils literal">PassUnknownArgs</tt> is true.</p>
<p>Configuration sources usually offer several config variants,
e.g. a <tt class="docutils literal">debug</tt> variant or a <tt class="docutils literal">PAE</tt> variant for <tt class="docutils literal">x86</tt>.
Such variants can be declared with <tt class="docutils literal"><span class="pre">[Feat:&lt;name&gt;]</span></tt> sections,
which are converted to <tt class="docutils literal">argparse</tt> arguments
and can be specified in the settings file with <tt class="docutils literal"><span class="pre">--&lt;name&gt;</span></tt>.</p>
<p>In the source definition file,
they are then available as <tt class="docutils literal"><span class="pre">param_{&lt;name&gt;}</span></tt> format variables
for options with <em>format str</em> values
Depending on the source type,
they can also be accessed via <tt class="docutils literal"><span class="pre">PARAM_{&lt;NAME&gt;}</span></tt> environment variables.</p>
<p>For script-type sources,
if no <tt class="docutils literal">Command=</tt> has been specified in the <tt class="docutils literal">[source]</tt> section,
the parameters are put in the default command
after the kernel version and before the unknown parameters:</p>
<pre class="literal-block">
{script_file} {outconfig} {arch} {kmaj}.{kpatch} [&lt;param&gt;...] [&lt;unknown&gt;...]
</pre>
<p>A <tt class="docutils literal"><span class="pre">[Feat:&lt;name&gt;]</span></tt> section can contain the following options:</p>
<table border="1" class="docutils">
<caption>source definition <tt class="docutils literal"><span class="pre">[Feature:&lt;name&gt;]</span></tt> section options</caption>
<colgroup>
<col width="21%" />
<col width="18%" />
<col width="13%" />
<col width="48%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">field name</th>
<th class="head">value type</th>
<th class="head">required</th>
<th class="head">description</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>Name</td>
<td>str</td>
<td>no</td>
<td><p class="first">Name of the parameter,
for informational purposes.</p>
<p class="last">Defaults to <tt class="docutils literal">&lt;name&gt;</tt>.</p>
</td>
</tr>
<tr><td>Description</td>
<td>str</td>
<td>no</td>
<td>Description of the parameter,
for informational purposes.</td>
</tr>
<tr><td>Dest</td>
<td>str</td>
<td>no</td>
<td><p class="first">Parameter group name,
parameters with the same <tt class="docutils literal">Dest</tt>
are mutually exclusive.</p>
<p>The group name is used as name
for the format and environment
variables.</p>
<p class="last">Defaults to <tt class="docutils literal">&lt;name&gt;</tt>.</p>
</td>
</tr>
<tr><td>Type</td>
<td>str</td>
<td>no</td>
<td><p class="first">The argument type of the parameter,
which can be</p>
<ul>
<li><dl class="first docutils">
<dt>const</dt>
<dd><p class="first last">parameter accepts no value
and a constant value (<tt class="docutils literal">Value</tt>)
gets stored in <tt class="docutils literal">Dest</tt>
if the parameter is given,
and the default value
(<tt class="docutils literal">Default</tt>) otherwise.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>optin</dt>
<dd><p class="first last">Similar to <em>const</em>,
stores <tt class="docutils literal">y</tt> and defaults to
the empty string</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>optout</dt>
<dd><p class="first last">Similar to <em>const</em>,
stores the empty string
and defaults to <tt class="docutils literal">y</tt>.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>arg</dt>
<dd><p class="first last">parameter accepts one value
and stores it in <tt class="docutils literal">Dest</tt>,</p>
</dd>
</dl>
</li>
</ul>
<p class="last">Defaults to <em>const</em>.</p>
</td>
</tr>
<tr><td>Default</td>
<td>str</td>
<td>no</td>
<td><p class="first">Default value if the parameter
is not specified.</p>
<p>Only meaningful for <em>const</em>- and
<em>arg</em>-type parameters.</p>
<p class="last">Defaults to the empty string.</p>
</td>
</tr>
<tr><td>Value</td>
<td>str</td>
<td>no</td>
<td><p class="first">Value gets set if the parameter
is given</p>
<p class="last">Only meaningful for <em>const</em>-type
parameters, in which case it defaults
to <tt class="docutils literal"><span class="pre">--&lt;name&gt;</span></tt>.</p>
</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
<div class="line"><br /></div>
</div>
<p>Another section exists that is only relevant to <tt class="docutils literal">pym</tt>-type sources,
<tt class="docutils literal">[Config]</tt>.
It can be accessed by the source via <tt class="docutils literal"><span class="pre">env.get_config(&lt;option&gt;)</span></tt>,
which options are recognized is therefore up to the source.</p>
</div>
<div class="section" id="python-module-configuration-sources">
<h3><a class="toc-backref" href="#contents">1.7.3&nbsp;&nbsp;&nbsp;Python-Module Configuration Sources</a></h3>
<p>Python-Module Configuration Sources gain access
to kernelconfig's functionality such as error reporting and logging,
and also temporary files/directories, file downloading and git repo handling.</p>
<p>A python module source must implement a <tt class="docutils literal">run()</tt> function that takes
exactly one argument, which is an object that acts as interface
between the source and kernelconfig. It should be named <tt class="docutils literal">env</tt>.</p>
<p>Additionally, a source definition file is required for this type,
and its <tt class="docutils literal">Type</tt> needs to be set to <tt class="docutils literal">pym</tt> (in the <tt class="docutils literal">[source]</tt> section).</p>
<p>Here is what a Python module looks like:</p>
<pre class="code Python literal-block">
<span class="comment single"># Python Module for the &lt;name&gt; configuration source</span>
<span class="comment single"># -*- coding: utf-8 -*-</span>

<span class="keyword">def</span> <span class="name function">reset</span><span class="punctuation">():</span>
    <span class="literal string doc">&quot;&quot;&quot;
    The reset() function is optional.

    It is called whenever the Python Module gets loaded.

    It takes no arguments and does not have access
    to kernelconfig's pymenv interface.

    Usage scenarios include initializing module-level global variables.
    &quot;&quot;&quot;</span>
    <span class="keyword">pass</span>
<span class="comment single"># --- end of reset (...) ---</span>


<span class="keyword">def</span> <span class="name function">run</span><span class="punctuation">(</span><span class="name">env</span><span class="punctuation">):</span>
    <span class="literal string doc">&quot;&quot;&quot;
    The run() function must be implemented
    and is responsible for setting up the configuration basis,
    e.g. by downloading files.

    To facilitate this, it has to access to kernelconfig's pymenv interface,
    which provides some useful helper methods
    as well as error reporting and logging.

    If this function returns False (or false value that is not None),
    kernelconfig prints an error message and exits.
    &quot;&quot;&quot;</span>

    <span class="comment single"># The parsed parameters can be accessed via the &quot;parameters&quot; attribute</span>
    <span class="name">params</span> <span class="operator">=</span> <span class="name">env</span><span class="operator">.</span><span class="name">parameters</span>

    <span class="comment single"># The kernel version for which a configuration basis should be provided</span>
    <span class="comment single"># can be accessed via the &quot;kernelversion&quot; attribute</span>
    <span class="name">kver</span> <span class="operator">=</span> <span class="name">env</span><span class="operator">.</span><span class="name">kernelversion</span>
    <span class="comment single">#</span>
    <span class="comment single"># The kernel version provides access to individual version components via</span>
    <span class="comment single"># the version, patchlevel, sublevel, subsublevel and rclevel attributes.</span>

    <span class="comment single"># As an example,</span>
    <span class="comment single"># the Liquorix source presented before</span>
    <span class="comment single"># could also be written as a Python-Module source.</span>
    <span class="comment single"># It needs to</span>
    <span class="comment single"># (1) construct the url by means of string formatting</span>
    <span class="comment single"># (2) download the config file</span>
    <span class="comment single"># (3) register the downloaded file as (part of the) configuration basis</span>
    <span class="comment single">#</span>
    <span class="comment single"># It can be done by chaining 3 function calls to pymenv,</span>
    <span class="comment single"># which also takes care of error handling:</span>
    <span class="name">env</span><span class="operator">.</span><span class="name">add_config_file</span><span class="punctuation">(</span>
        <span class="name">env</span><span class="operator">.</span><span class="name">download_file</span><span class="punctuation">(</span>
            <span class="name">env</span><span class="operator">.</span><span class="name">str_format</span><span class="punctuation">(</span>
                <span class="literal string single">'http://liquorix.net/sources/{kmaj}.{kpatch}/config.{param_arch}{param_pae}'</span>
            <span class="punctuation">)</span>
        <span class="punctuation">)</span>
    <span class="punctuation">)</span>

    <span class="comment single"># the configuration basis can consist of multiple files,</span>
    <span class="comment single"># just register them in the order as they should be read later on</span>
    <span class="comment single">#</span>
    <span class="comment single"># env.add_config_file(another_config_file)</span>
<span class="comment single"># --- end of run (...) ---</span>
</pre>
<p>Template files for <em>pym</em>-type configuration sources can be found
in <tt class="docutils literal"><span class="pre">&lt;settings&gt;/sources/skel</span></tt>,
named <tt class="docutils literal">pymsource.def</tt> (source definition file)
and <tt class="docutils literal">pymsource</tt> (Python module).</p>
<p>The methods and attributes available via the <tt class="docutils literal">pymenv</tt> interface
are covered in detail as in-code documentation,
which can be read with <tt class="docutils literal">pydoc kernelconfig.sources.pymenv</tt>.</p>
<p>The class-level documentation gives a quick reference over what is offered:</p>
<pre class="code Python literal-block">
<span class="keyword">class</span> <span class="name class">PymConfigurationSourceRunEnv</span><span class="punctuation">(</span><span class="operator">...</span><span class="punctuation">):</span>
    <span class="literal string doc">&quot;&quot;&quot;
    This is the runtime environment that gets passed
    to configuration source python modules, version 1.

    The python module's run() function
    receives the environment as first arg,
    interfacing with kernelconfig should only occur via this environment.

    The following attributes can be referenced by the python module,
    they should all be treated as readonly except where noted otherwise,
    see the &#64;property in-code doc for details:

    * logger:         logger, can also be accessed via log_*() methods

    * name:           conf source name
    * exc_types:      exception types (namespace object/module)
    * parameters:     arg parse result (namespace object)
    * environ:        extra-env vars dict
    * str_formatter:  string formatter
    * format_vars:    string formatter's vars dict
    * kernelversion:  kernel version object
    * tmpdir:         temporary dir object
    * tmpdir_path:    path to temporary dir

    The following methods can be used for communicating with kernelconfig:

    * log_debug(...)         --  log a debug-level message
    * log_info(...)          --  log an info-level message
    * log_warning(...)       --  log a warning-level message
    * log_error(...)         --  log an error-level message

    * error([msg])           --  signal a &quot;config uncreatable&quot; error
                                 (log an error-level message
                                  and raise an appropriate exception)

    * add_config_file(file)  --  add a .config file that will later be
                                 used as configuration basis
                                 (can be called multiple times
                                 in splitconfig scenarios)

    The pym-environment also offers some helper methods, including:

    * run_command(cmdv)      --  run a command
    * get_tmpfile()          --  create new temporary file

    * download(url)          --  download url, return bytes
    * download_file(url)     --  download url to temporary file


    * git_clone_configured_repo()
                             --  clone the repo configured in [config]
                                 and change the working dir to its path

    * git_clone(url)         --  clone a git repo and returns it path,
                                  using a per-confsource cache dir
    * git_checkout_branch(branch)
                             --   switch to git branch

    * run_git(argv)          --  run a git command in $PWD
    * run_git_in(dir, argv)  --  run a git command in &lt;dir&gt;
    &quot;&quot;&quot;</span>
</pre>
</div>
</div>
</div>
</div>
<div class="footer">
<hr class="footer" />
Generated on: 2016-08-15.

</div>
</body>
</html>
